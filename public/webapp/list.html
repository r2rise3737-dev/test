<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>Angela Courses</title>
<style>
:root{--bg:#0b0f15;--card:#131923;--text:#e6edf3;--muted:#aab4c0;--accent:#7aa2ff;--glow1:rgba(122,162,255,.18);--glow2:rgba(0,0,0,.45)}
:root.theme-tarot{--accent:#ffb86b;--glow1:rgba(255,184,107,.20)}
*{box-sizing:border-box} html,body{height:100%;margin:0}
body{color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;background:transparent}
body::before{content:"";position:fixed;inset:0;background:url("/webapp/bg-app.png?v=skin7") center/cover no-repeat;z-index:-2}
body::after{content:"";position:fixed;inset:0;background:
  radial-gradient(1000px 55% at 50% -10%, var(--glow1), transparent 60%),
  linear-gradient(180deg, rgba(5,7,10,.42), rgba(5,7,10,.72) 60%, rgba(5,7,10,.84)); z-index:-1; pointer-events:none}
.wrap{max-width:720px;margin:0 auto;padding:16px clamp(12px,4vw,20px) max(24px, env(safe-area-inset-bottom) + 16px); min-height:100svh}
.badge{display:inline-block;padding:8px 12px;margin:4px 0 14px;border-radius:999px;font-weight:600;font-size:14px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.14);box-shadow:0 10px 30px var(--glow2)}
.grid{display:grid;grid-template-columns:1fr;gap:10px}
.btn{display:flex;justify-content:space-between;align-items:center;gap:14px;padding:16px 18px;border-radius:16px;background:rgba(19,25,35,.58);border:1px solid rgba(255,255,255,.08);backdrop-filter:blur(6px);box-shadow:0 8px 24px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.03);cursor:pointer;text-align:left}
.btn:hover{ border-color: color-mix(in oklab, var(--accent) 35%, white 0%) }
.title{font-weight:700;background:linear-gradient(92deg,#F6E27A,#E3B84C,#F6E27A);-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 1px 8px rgba(255,215,0,.18)}
.price{color:var(--muted)}
.note{margin-top:10px;color:var(--muted);font-size:13px}
.hidden{display:none}
a, a:visited { color: inherit; text-decoration: none; }
.btn, .btn:visited, .btn:hover { text-decoration: none !important; color: inherit !important; }
.btn .title { text-decoration: none !important; }
a, a:visited { color: inherit; text-decoration: none; }
.btn, .btn:visited, .btn:hover { text-decoration: none !important; color: inherit !important; }
.btn .title { text-decoration: none !important; }
a, a:visited { color: inherit; text-decoration: none; }
.btn, .btn:visited, .btn:hover { text-decoration: none !important; color: inherit !important; }
.btn .title { text-decoration: none !important; }
a, a:visited { color: inherit; text-decoration: none; }
.btn, .btn:visited, .btn:hover { text-decoration: none !important; color: inherit !important; }
.btn .title { text-decoration: none !important; }
</style>
</head>
<body>
<div class="wrap">
  <div class="badge" id="hdr">пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ</div>
  <div class="grid" id="list"></div>
  <div class="note">пїЅпїЅпїЅпїЅпїЅпїЅ Stars пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅ Telegram. пїЅпїЅпїЅпїЅпїЅпїЅ пїЅ пїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ.</div>
</div>

<script>
(function(){
  // --- пїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅ query ?section=... пїЅпїЅпїЅ пїЅпїЅ start_param ---
  function detectSection(){
    const qs = new URLSearchParams(location.search);
    const q = qs.get('section');
    if(q==='astro' || q==='tarot') return q;
    try{
      const tg = window.Telegram && Telegram.WebApp;
      const sp = tg && tg.initDataUnsafe && tg.initDataUnsafe.start_param;
      if(sp){
        const p = new URLSearchParams(sp);
        const s = p.get('section');
        if(s==='astro' || s==='tarot') return s;
      }
    }catch(e){}
    return 'tarot';
  }
  const section = (() => {
  let s = 'tarot';
  const url = new URL(location.href);

  const qSec = url.searchParams.get('section');
  if (qSec === 'astro' || qSec === 'tarot') s = qSec;

  const qTg = url.searchParams.get('tgWebAppStartParam');
  if (qTg) { try { const p = new URLSearchParams(qTg); const v = p.get('section'); if (v==='astro'||v==='tarot') s=v; } catch(e){} }

  const hash = new URLSearchParams(location.hash.replace(/^#/, ''));
  const hTg = hash.get('tgWebAppStartParam');
  if (hTg) { try { const p = new URLSearchParams(hTg); const v = p.get('section'); if (v==='astro'||v==='tarot') s=v; } catch(e){} }

  try {
    const tg = (window.Telegram && Telegram.WebApp) ? Telegram.WebApp : null;
    const sp = tg && tg.initDataUnsafe && tg.initDataUnsafe.start_param;
    if (sp) { const p = new URLSearchParams(sp); const v = p.get('section'); if (v==='astro'||v==='tarot') s=v; }
  } catch(e){}

  return s;
})();
  const url = new URL(location.href);

  // 1) ?section=astro|tarot
  const qSec = url.searchParams.get('section');
  if (qSec === 'astro' || qSec === 'tarot') s = qSec;

  // 2) ?tgWebAppStartParam=section%3Dastro
  const qTg = url.searchParams.get('tgWebAppStartParam');
  if (qTg) { try { const p = new URLSearchParams(qTg); const v = p.get('section'); if (v==='astro'||v==='tarot') s=v; } catch(e){} }

  // 3) #tgWebAppStartParam=...
  const hash = new URLSearchParams(location.hash.replace(/^#/, ''));
  const hTg = hash.get('tgWebAppStartParam');
  if (hTg) { try { const p = new URLSearchParams(hTg); const v = p.get('section'); if (v==='astro'||v==='tarot') s=v; } catch(e){} }

  // 4) initDataUnsafe.start_param
  try {
    const tg = (window.Telegram && Telegram.WebApp) ? Telegram.WebApp : null;
    const sp = tg && tg.initDataUnsafe && tg.initDataUnsafe.start_param;
    if (sp) { const p = new URLSearchParams(sp); const v = p.get('section'); if (v==='astro'||v==='tarot') s=v; }
  } catch(e){}

  return s;
})();
  (section==='astro' ? document.documentElement.classList.add('theme-astro')
                     : document.documentElement.classList.add('theme-tarot'));

  // --- пїЅпїЅпїЅпїЅпїЅ-пїЅпїЅпїЅпїЅпїЅ ---
  const hdr = document.getElementById('hdr');
  hdr.textContent = (section==='astro')
    ? 'пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅ пїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅ'
    : 'пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅ пїЅпїЅпїЅпїЅ пїЅ пїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅ';

  // --- пїЅпїЅпїЅпїЅпїЅпїЅ ---
  const v='skin7';
  const coursesUrl = '/data/courses.json?v='+v;
  const linksUrl   = '/data/invoice-links.json?v='+v;
  const rate = 1.4668; // ? > ? пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ

  Promise.all([fetch(coursesUrl).then(r=>r.json()), fetch(linksUrl).then(r=>r.json())])
    .then(([courses, links])=>{
      const ids = (section==='astro')
        ? ['astro-basic','astro-profi','astro-synastry','astro-blog-business','astro-master']
        : ['tarot-basic','pro-interpretation','love-money-spreads','tarot-for-brands','master-diagnostics'];

      const grid = document.getElementById('list');
      ids.map(id => courses.find(c=>c.id===id)).filter(Boolean).forEach(c=>{
        const a = document.createElement('a');
        a.className='btn';
        a.href = links[c.id] || '#';
        a.addEventListener('click',(ev)=>{
          ev.preventDefault();
          openInvoice(a.href);
        });

        const left = document.createElement('div');
        left.style.flex='1 1 auto';

        const t = document.createElement('div');
        t.className='title';
        t.textContent = c.label;

        const p = document.createElement('div');
        p.className='price';
        const parts=[];
        if(typeof c.rub==='number') parts.push(c.rub.toLocaleString('ru-RU')+' ?');
        if(typeof c.rub==='number') parts.push(Math.round(c.rub/rate).toLocaleString('ru-RU')+' ?');
        p.textContent = parts.join('  пїЅ  ');

        left.appendChild(t);
        left.appendChild(p);
        a.appendChild(left);
        grid.appendChild(a);
      });
    })
    .catch(e=>{
      hdr.textContent = 'пїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ. пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ.';
      console.error(e);
    });

  // --- пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ Stars-пїЅпїЅпїЅпїЅпїЅпїЅпїЅ ---
  window.openInvoice = function(url){
    try{
      if (window.Telegram && Telegram.WebApp && /^https:\/\/t\.me\/\$/i.test(url)) {
        Telegram.WebApp.openInvoice(url, function(){});
        return;
      }
    }catch(e){}
    if(url) location.href = url; // пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅ
  };
})();
</script>
<!-- PATCH: hdr title -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const hdr = document.getElementById("hdr");
  if (!hdr) return;
  const copy = (section === "astro")
    ? "пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ  Angela Pearl"
    : "пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅ пїЅпїЅпїЅпїЅ  Angela Pearl";
  const set = () => { if (hdr.textContent !== copy) hdr.textContent = copy; };
  set();
  try { new MutationObserver(set).observe(hdr, {childList:true, characterData:true, subtree:true}); } catch(e){}
});
</script>
<!-- /PATCH -->
<!-- PATCH:fallback-render -->
<script>
(function(){
  function detectSection(){
    var s = 'tarot';
    try{
      var url = new URL(location.href);
      var q = url.searchParams.get('section'); if(q==='astro'||q==='tarot') s=q;
      var t1 = url.searchParams.get('tgWebAppStartParam');
      if(t1){ var p1 = new URLSearchParams(t1); var v1 = p1.get('section'); if(v1==='astro'||v1==='tarot') s=v1; }
      var hp = new URLSearchParams(location.hash.replace(/^#/, ''));
      var t2 = hp.get('tgWebAppStartParam');
      if(t2){ var p2 = new URLSearchParams(t2); var v2 = p2.get('section'); if(v2==='astro'||v2==='tarot') s=v2; }
      if(window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe){
        var sp = Telegram.WebApp.initDataUnsafe.start_param;
        if(sp){ var p3 = new URLSearchParams(sp); var v3 = p3.get('section'); if(v3==='astro'||v3==='tarot') s=v3; }
      }
    }catch(e){}
    return s;
  }

  function headerCopy(sec){
    return (sec==='astro') ? 'пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ  Angela Pearl'
                           : 'пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅ пїЅпїЅпїЅпїЅ  Angela Pearl';
  }

  async function render(){
    var sec = detectSection();

    const courses = await fetch('/data/courses.json?v=skin15').then(r=>r.json());
    const links   = await fetch('/data/invoice-links.json?v=skin15').then(r=>r.json());

    // пїЅпїЅпїЅпїЅ 5 пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅ
    const items = courses.filter(c => (sec==='astro') ? (c.id||'').startsWith('astro-')
                                                      : !(c.id||'').startsWith('astro-')).slice(0,5);

    // пїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ  пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅ id
    if(items.length){
      sec = items[0].id.startsWith('astro-') ? 'astro' : 'tarot';
    }

    // пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ + пїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ
    var hdr = document.getElementById('hdr');
    if(hdr){
      const want = headerCopy(sec);
      hdr.textContent = want;
      try{
        new MutationObserver(()=>{ if(hdr.textContent!==want) hdr.textContent = want; })
          .observe(hdr,{childList:true,characterData:true,subtree:true});
      }catch(e){}
    }

    // пїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ
    var grid = document.querySelector('.grid');
    if(!grid) return;
    grid.innerHTML = '';

    const rate = 1.4668;
    const starsFromRub = rub => Math.round(rub / rate);
    const star = String.fromCodePoint(0x2B50); // пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ 

    items.forEach(c=>{
      const a = document.createElement('a');
      a.className = 'btn';
      a.href = links[c.id] || '#';
      a.addEventListener('click', function(ev){
        ev.preventDefault();
        try{
          if (window.Telegram && Telegram.WebApp && Telegram.WebApp.openInvoice){
            Telegram.WebApp.openInvoice(a.href);
            return;
          }
        }catch(e){}
        location.href = a.href;
      });

      const left = document.createElement('div');
      left.style.display='flex';
      left.style.flexDirection='column';
      left.style.gap='8px';

      const title = document.createElement('div');
      title.className='title';
      title.textContent = c.label;

      const price = document.createElement('div');
      price.className='price';
      // пїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅ, пїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅ  пїЅпїЅпїЅпїЅпїЅпїЅ пїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅ
      const starsTxt = (typeof c.rub==='number')
        ? (starsFromRub(c.rub).toLocaleString('ru-RU') + ' ' + star)
        : '';
      price.textContent = starsTxt;

      left.appendChild(title);
      left.appendChild(price);
      a.appendChild(left);
      grid.appendChild(a);
    });
  }

  // пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ: пїЅпїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅпїЅ/пїЅпїЅпїЅпїЅпїЅпїЅ пїЅ пїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅпїЅпїЅ пїЅпїЅпїЅпїЅ
  const style = document.createElement('style');
  style.textContent = `
    a, a:visited { color: inherit; text-decoration: none; }
    .btn, .btn:visited, .btn:hover { text-decoration: none !important; color: inherit !important; }
    .btn .title { text-decoration: none !important; }
    .price { font-weight: 700; font-size: 16px; line-height: 1.2; }
  `;
  document.head.appendChild(style);

  if(document.readyState!=='loading') render(); else document.addEventListener('DOMContentLoaded', render);
})();
</script>
<!-- /PATCH:fallback-render -->
</body>
</html>
